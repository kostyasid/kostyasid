function Stage(t,e,n){var r=this;r.id=t,r.actionName=e,r.state=null,r.getCurrentStateDescription=function(){return r.state?n.apply(r):""},r.errorMessage=null,r.nextStage=null}!function(t){"use strict";t.module("quantacann2.warmup",["quantacann2.warmup.CONFIG"])}(angular),function(t){"use strict";t.module("quantacann2.warmup.CONFIG",[]).constant("WARMUP_CONFIG",function(){var t={apiPath:""};return t}())}(angular),function(t){"use strict";t.module("quantacann2.warmup").constant("stateValues",{start:"start",finish:"finish",error:"error"})}(angular),function(t){"use strict";t.module("quantacann2.warmup").directive("quantacann2Warmup",["warmupService",function(t){return{scope:{unitId:"@",unitName:"@"},restrict:"E",replace:!0,templateUrl:function(t,e){return e.useTemplate||"src/templates/quantacann2-warmup.tpl.html"},link:function(e){e.warmup=t,e.$watch("unitId",function(t,n){t!=n&&t&&!e.warmup.isProcess()&&e.warmup.startWarmupProcess(e.unitId,e.unitName)})}}}])}(angular),function(t){"use strict";t.module("quantacann2.warmup").provider("warmupService",function(){var t={},e=[],n=null,r=!1;this.$get=["$http","WARMUP_CONFIG","$timeout","stateValues",function(a,i,u,s){function o(){return this}Stage.prototype.setErrorMessage=function(t){var e=t.response?t.response:t;e.status>=400&&e.status<500&&(this.errorMessage=e.data.error?e.data.error.msg:e.data.message)},Stage.prototype.canExecuteStage=function(){for(var t=this,e=!0,r=n;r&&t.id!=r.id&&e;)t.id!=r.id&&r.state!=s.finish&&(t.errorMessage="Can't start "+t.id+" stage.",t.state=s.error,e=!1),r=r.nextStage;return e},Stage.prototype.action=function(){var e=this;e.canExecuteStage()&&(r=!0,e.state=s.start,e.errorMessage=null,a.get(i.apiPath+"units/"+t.id+"/"+e.actionName).then(function(t){e.successAction(t)}).catch(function(t){e.setErrorMessage(t),r=!1,e.state=s.error}))},Stage.prototype.successAction=function(t,e){var n=this;n.state=s.finish,n.nextStage?n.nextStage.action(e):r=!1};var c=new Stage("check_instrument","status",function(){var t=this;return t.state!=s.error?"Instrument Online":"Instrument Offline"}),m=new Stage("set_temperature","tec",function(){var t=this;return t.state!=s.error?"Set TE Cooler Temperature":"Set TE Cooler Temperature Failed"}),g=new Stage("set_light","warmup",function(){var t=this;return t.state!=s.error?"Turn on Source Light":"Turn on Source Light Failed"}),p=new Stage("wait_warmup","",function(){var t=this,e=function(){if(t.remainingTime){if(t.remainingTime<60)return t.remainingTime+" second"+(t.remainingTime>1?"s":"");var e=Math.floor(t.remainingTime/60),n=t.remainingTime%60;return e+" minute"+(e>1?"s ":" ")+(n>0?n+" second"+(n>1?"s":""):"")}return""};return t.state==s.start?"Warmup Time Remaining: "+e():t.state==s.finish?"Instrument is warm":void 0});n=c,c.nextStage=m,m.nextStage=g,g.nextStage=p,c.successAction=function(t){var e=this;t.data.status?(e.errorMessage="Instrument is not online.",r=!1,e.state=s.error):Stage.prototype.successAction.call(e,t)},g.successAction=function(t){var e=this;if("on1"==t.data.lightState){var n=t.data.warmupTime-t.data.lightDuration;Stage.prototype.successAction.call(e,t,{remainingTime:n})}else e.errorMessage="Impossible turn on instrument.",r=!1,e.state=s.error},p.action=function(t){var e=this;if(e.canExecuteStage())if(r=!0,e.state=s.start,t&&t.remainingTime&&(e.remainingTime=t.remainingTime),!e.remainingTime||e.remainingTime<=0)e.state=s.finish,r=!1;else{var n=function(){e.remainingTime--,e.remainingTime>0?u(n,1e3):(e.state=s.finish,r=!1)};u(n,1e3)}},e=[c,m,g,p],o.prototype.getRootStage=function(){return n},o.prototype.getUnit=function(){return t},o.prototype.getStages=function(){return e},o.prototype.isProcess=function(){return r},o.prototype.startWarmupProcess=function(a,i){if(!r){for(var u=0;u<e.length;u++)e[u].state=null,e[u].errorMessage=null;t.id=a,t.name=i,n.action()}};var f=new o;return f}]})}(angular),function(t,e){"undefined"!=typeof module&&module.exports?(e("undefined"==typeof angular?require("angular"):angular),module.exports="quantacann2"):"function"==typeof define&&define.amd?define(["../../bower_components/angular/angular"],e):e(t.angular)}(this,function(t){"use strict";var e=t.module("quantacann2",["quantacann2.warmup"]);return e});